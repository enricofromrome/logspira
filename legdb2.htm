<!DOCTYPE HTML>
<html lang="en">
<head>
<title>edb 2021</title>
<meta name="theme-color" content="#7E7EFB"/>
<meta name=viewport content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json"> 
<meta charset="UTF-8">
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" sizes="36x36" href="launcher-icon-0-75x.png">
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<style>
body {margin:0;font-size: 1em; /* 30px/16=1.875em */
    user-select: none; /* Standard syntax */
}
button {font-size: 2em; /* 30px/16=1.875em */}
.sopra {display: none;
position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
overflow-y: auto;
background-color:red;
}
      input { background-color:white; color:blue;  font:14px courier new; border:1px outset gold; }
      input:focus {background-color:yellow; color:red; }
      select { background-color:white; color:blue;  font:14px courier new; border:1px outset gold; }
      select:focus {background-color:yellow; color:red; }
      
form.html5-form {
  max-width: 95%;
}

.indice { background-color:#ffffff; color:blue;  font:24 px monospace;
width: 95%;
    height: 180px;padding-top: 0px; padding-bottom: 0px;white-space: nowrap;
    overflow-y: scroll;
    overflow-x:hidden;cursor:pointer;
     display: flex;
  flex-direction: row; flex-wrap: wrap;
}
.indice > div {
border: rounded;text-align: center;
border-style: ridge;border-width: 2px;border-radius: 10px;width: 320px;
}
</style>
<script>
function ricp(che){
f=params.substr(che.length+params.indexOf(che))+"&"
r=f.substr(0,f.indexOf("&"))
if(params.indexOf(che)==-1){r=""}
return r
}
var questocampo=""
const params = window.location.hash.substr(1);
const arc = ricp("arc=");
const quale = ricp("questo=");
const babbo = ricp("babbo=");
const qbab = ricp("qbab=");
const inclusore = ricp("inclusore=");
const qualeincl = ricp("qualeincl=");
if (top.sys===undefined){ed=opener.sys;papi=opener}else{ed=top.sys;papi=top}
if (arc=="menu"){
questo=[0, 4, "menu", "180", "90", "90", "30", "yellow", "darkgray", "", "1", ""]
unasc=[[4, 0, "descr", "sMmri0-9", "isinCSV", "pattern", "etc"]
,[4, 1, "menu", "0", "1", "", ""]
,[4, 2, "name", "s", "1", "", "!"]
,[4, 3, "img(opt)", "i", "1", "", ""]
,[4, 4, "posX", "0", "1", "", ""]
,[4, 5, "posY", "0", "1", "", ""]
,[4, 6, "dimX", "0", "1", "", ""]
,[4, 7, "dimY", "0", "1", "", ""]
,[4, 8, "FGcol", "s", "1", "", ""]
,[4, 9, "BGcol", "s", "1", "", ""]
,[4, 10, "actn", "H", "1", "", ""]]

}else
{
edb=ed.edbsys
strato=[];// edb=struttura d=dati c=corrente
//console.log(ed.d)
d=ed.d
if (d===undefined){d=[]}
c=ed.c
if (c===undefined){c=[]}
mydad=[]
for (var r = 1, n = edb[0].length; r < n; r++) {mydad[r]=0;if(c[r]===undefined){c[r]=0}}


questo=edb[0][arc]
chi=arc

unasc=edb[chi]
}
cosa=quale
</script>
</head>
<body style="">
<div id="scheda" class="sopra">
<form><div id='pip2' class="indice" style="height:300px;"></div></form>
<button onclick="chiudisch()" style="color:white;background-color: #f86;width:160px;">X</button><span id='detit'></span>
<div id='pip3'></div>
</div>
<div id="uncampo" class="sopra" style="top:40px;">
<div id='pip4'></div>
</div>
<script>

// questo= edb[0][arc]

document.getElementById("scheda").style.display="block"
document.getElementById("scheda").style.backgroundColor=questo[7]
aggprimo=questo[2]+" - "
qsric=0
for (iiii = 1; iiii < unasc.length;iiii++) {
var kk=unasc[iiii][3].substr(0,1).toUpperCase()
if ("SMRPED012345789".indexOf(kk)>=0){
DV = document.createElement("div");
textnode = document.createTextNode(aggprimo + unasc[iiii][2])
aggprimo=""
DV.appendChild(textnode)
DV.appendChild(document.createElement("br"))
inp=document.createElement("INPUT")
tipologia="text"
if("012345789".indexOf(kk)>=0){tipologia="number"}
if(kk=="D"){tipologia="date"}
if(kk=="E"){tipologia="email"}
if(kk=="P"){tipologia="tel"}
inp.setAttribute("type",tipologia)
let qiii=iiii

if (arc=="menu"){coso=ed.menu[cosa][qiii-1]}
else
{
if(inclusore==""){
if (babbo==0){coso=d[chi][cosa][qiii]}
else {coso=d[babbo][qbab][0][chi][cosa][qiii]}}
if(inclusore){
if (qbab=="null"){coso=d[inclusore][qualeincl][0][chi][cosa][qiii]}
else {coso=d[babbo][qbab][0][inclusore][qualeincl][0][chi][cosa][qiii]}
}
}
if ("undefined" === typeof coso){coso=""}
tipor="";colr=""
if (kk=="R"){
let qs=iiii
tipor=unasc[qs][3].substr(1)
arcr=parseInt(tipor)
colr="color: black;"
colr+="background-color: "+ed.edbsys[0][arcr][7]+";"
inp.readOnly = true;
inp.id="rc"+qs
inp.onclick=function(){
qsric=qs
tipor=unasc[qs][3].substr(1)
arcr=parseInt(tipor)
var input = document.createElement('IFRAME');
input.src="legdb1.htm#arc="+arcr+"&questo=0&babbo=0&qbab=0&funz=scegli"
input.setAttribute('width',"98%");
alto=320
input.setAttribute('height',alto);
document.getElementById("pip4").appendChild(input)
document.getElementById("uncampo").style.background=ed.edbsys[0][arc][7]
document.getElementById("uncampo").style.display="block"
}
if (!!parseInt(coso)){coso=ed.d[arcr][parseInt(coso)][1]}
}
inp.setAttribute("value",coso)
inp.setAttribute("style","width:300px;"+colr)
inp.onchange=function(){
if (qbab!=="null") {
if (inclusore==""){
d[babbo][qbab][0][chi][cosa][qiii]=this.value
}
else {
d[babbo][qbab][0][inclusore][qualeincl][0][chi][cosa][qiii]=this.value
}
}
else {
if (inclusore==""){
d[chi][cosa][qiii]=this.value
}
else {
d[inclusore][qualeincl][0][chi][cosa][qiii]=this.value
}

}
top.slv.style.backgroundColor="Tomato"
}
DV.appendChild(inp)
document.getElementById("pip2").appendChild(DV)
//document.getElementById("pip2").appendChild(document.createElement("br"))
}
else if ("ITHAWVX".indexOf(kk)>=0){
if (arc=="menu"){
document.getElementById("pip3").innerHTML = document.getElementById("pip3").innerHTML+ "<button onclick='unc(\"menu\","+iiii+","+cosa+")'>"+unasc[iiii][2]+"</button>"}
else
{document.getElementById("pip3").innerHTML = document.getElementById("pip3").innerHTML+ "<button onclick='unc("+chi+","+iiii+","+cosa+")'>"+edb[chi][iiii][2]+"</button>"}
}
}

if(Array.isArray(questo) && isNaN(questo[9])){
//zona richiami m e s
var roba = questo[9].toLowerCase()
var patt = new RegExp("m|s|i")
while (roba.length){
chiama=parseInt(roba)
come=patt.exec(roba)
esse=roba.search(come)
taglia=esse+1
chiamato=edb[0][chiama]
if (come=="m" || come=="i"){
//console.log(chiamato[2])
var x = document.createElement("BUTTON");
x.onclick=function() {
sd="legdb3.htm#arc="+chiama+"&inclusore="+arc+"&qualeincl="+quale+"&babbo="+ babbo+"&qbab="+qbab+"&funz=entra"
top.apri(sd)
}
x.style.backgroundColor=chiamato[7]
    var t = document.createTextNode(chiamato[2]);
    x.appendChild(t);
    document.getElementById("pip3").appendChild(x);
}

if (taglia>0) {roba=roba.substr(taglia)} else {roba=""}



}
}
chisono=""
if (babbo*1){chisono=ed.edbsys[0][babbo][2]+": "+ed.d[babbo][qbab][1]+ " - "}
if (inclusore*1){
chisono+=ed.edbsys[0][inclusore][2];
if (babbo*1){chisono+=": "+ed.d[babbo][qbab][0][inclusore][qualeincl][1]+ " - "}
else{chisono+=": "+ed.d[inclusore][qualeincl][1]+ " - "}
}
chisono+=ed.edbsys[0][arc][2]+" "+quale
document.getElementById("detit").innerHTML=" "+chisono

// unc significa un campo___________________________________
function unc(arc,ele,ppp){
document.getElementById("uncampo").style.display="block"
document.getElementById("uncampo").style.backgroundColor=questo[7]
var tipo=unasc[ele][3].substr(0,1).toUpperCase()
var tipod=unasc[ele][3].toUpperCase().substr(1,1)
//console.log(tipo)
if (arc=="menu"){coso=ed.menu[cosa][ele-1]}
else
{
if (babbo==0){
if (qualeincl==""){coso=ed.d[arc][ppp][ele]}
else {coso=ed.d[inclusore][qualeincl][0][arc][ppp][ele]}
}
else{
if (qualeincl==""){coso=ed.d[babbo][qbab][0][arc][ppp][ele]}
else{coso=ed.d[babbo][qbab][0][inclusore][qaleincl][0][arc][ppp][ele]}
}}
if (!coso==undefined){valore=atob(coso)}

if (tipo=="T"||tipo=="A"){

document.getElementById("pip4").appendChild(document.createElement('br'))
var input = document.createElement('TEXTAREA');
input.setAttribute('name', 'post');
//input.setAttribute('maxlength', 5000);
input.id="untesto"
input.onchange=function(){top.slv.style.backgroundColor="Tomato"}
input.setAttribute('cols',40);
input.setAttribute('rows', 15);
document.getElementById("pip4").appendChild(input)
if (tipo=="A"){
var dd=new Date();
ddd=dd.getFullYear()+"-"+(dd.getMonth()+1)+"-"+dd.getDate()+" "+dd.getHours()+":"+dd.getMinutes()
var prima=document.createElement('p');prima.setAttribute('id', 'prim');
prima.setAttribute('style','width:90%;height:240px;overflow:auto;background-color:white;text-align: justify;padding:8px;')
prima.innerHTML="<br>"+ddd+"<hr>"
document.getElementById("pip4").appendChild(prima)
}
if (coso){
if (tipo=="T"){input.value=unescape(atob(coso))}
if (tipo=="A"){
prima.innerHTML+=unescape(atob(coso))}
}

}


if (tipo=="H" || tipo=="I" || tipo=="W" || tipo=="X"){
questocampo=coso;if (!questocampo){questocampo=""}
var input = document.createElement('IFRAME');
if (tipo=="X"){prg=edb[arc][ele][6]}
if (tipo=="H"){prg="corrhtm.htm"}
if (tipo=="I"){prg="corrimm.htm"}
if (tipo=="I" && tipod=="S"){prg="gallery.php?cosa=/id/"}
if (tipo=="W"){prg="corrwav.htm"}
input.src=prg+location.hash+"&campo="+ele
input.setAttribute('width',"98%");
alto=document.getElementById("uncampo").offsetHeight-100
input.setAttribute('height',alto);
document.getElementById("pip4").appendChild(input)
}

if ((tipo!="H" && tipo!="W")){
document.getElementById("pip4").appendChild(document.createElement('br'))
var x = document.createElement("BUTTON");
x.onclick= function(){
if (tipo=="T"||tipo=="A"){
if (tipo=="A")
{
meme=""
mema=document.getElementById('prim').innerHTML.toString()
meme=btoa(escape(document.getElementById('untesto').value+mema))
if (document.getElementById('untesto').value.length==0){meme=coso}
}else{
meme=btoa(escape(document.getElementById('untesto').value))}

if (babbo==0){
if (qualeincl==""){ed.d[arc][ppp][ele]=meme}
else {ed.d[inclusore][qualeincl][0][arc][ppp][ele]=meme}
}
if (babbo>=1){
if (qualeincl==""){ed.d[babbo][qbab][0][arc][ppp][ele]=meme}
else {ed.d[babbo][qbab][0][inclusore][qualeincl][0][arc][ppp][ele]=meme}
}


}

dett=document.getElementById('uncampo');
document.getElementById('pip4').innerHTML='';dett.style.display='none'}

x.style.backgroundColor="#f86";x.style.color="white";
    var t = document.createTextNode("X");
    x.appendChild(t);
    document.getElementById("pip4").appendChild(x);

document.getElementById("pip4").appendChild(document.createTextNode(unasc[ele][2]))
}
}


function chiudisch(){
f=location.hash.substr(1)
//if (screen.orientation.type[0]=="p"){
if(top.telef==1){
if (!inclusore){top.chiudi(f)}else{parent.chiudi()}
//parent.chiudi()
} else {window.close()}
}
function richiama(boh){
tipor=unasc[qsric][3].substr(1)
arcr=parseInt(tipor)
top.slv.style.backgroundColor="Tomato"
//alert("pag"+boh+" campo"+qsric+" arcric"+arcr)
idr="rc"+qsric
document.getElementById(idr).setAttribute("value",ed.d[arcr][boh][1])
if (babbo==0){
if (qualeincl==""){ed.d[arc][cosa][qsric]=boh}
else {ed.d[inclusore][qualeincl][0][arc][cosa][qsric]=boh}
}
if (babbo>=1){
if (qualeincl==""){ed.d[babbo][qbab][0][arc][cosa][qsric]=boh}
else {ed.d[babbo][qbab][0][inclusore][qualeincl][0][arc][cosa][qsric]=boh}
}
dett=document.getElementById('uncampo');document.getElementById('pip4').innerHTML='';dett.style.display='none'
}
</script>




</body>
<script>
z=document.getElementById("pip2").offsetWidth
colonne=Math.floor(z/500)
//if (colonne>1){document.getElementById("pip2").style.columnCount = colonne;}
</script>
</html>

